{"version":3,"sources":["index.js"],"names":["require","h","Plugin","Translator","DashboardUI","StatusBar","Informer","ThumbnailGenerator","findAllDOMElements","toArray","getDroppedFiles","trapFocus","cuid","ResizeObserver","default","createSuperFocus","memoize","TAB_KEY","ESC_KEY","createPromise","o","promise","Promise","resolve","reject","defaultPickerIcon","module","exports","uppy","opts","setOptions","newOpts","i18nInit","translator","defaultLocale","locale","i18n","translate","bind","i18nArray","translateArray","setPluginState","removeTarget","plugin","pluginState","getPluginState","newTargets","targets","filter","target","id","addTarget","callerPluginId","constructor","name","callerPluginName","title","callerPluginType","type","msg","log","state","slice","push","el","hideAllPanels","update","activePickerPanel","showAddFilesPanel","activeOverlayType","fileCardFor","showFileEditor","current","showPanel","canEditFile","file","editors","_getEditors","some","getPlugin","openFileEditor","forEach","editor","selectFile","openModal","savedScrollPosition","window","pageYOffset","savedActiveElement","document","activeElement","disablePageScrollWhenModalOpen","body","classList","add","animateOpenClose","isClosing","handler","isHidden","removeEventListener","addEventListener","browserBackButtonClose","updateBrowserHistory","handleKeyDownInModal","emit","closeModal","manualClose","remove","superFocus","cancel","focus","history","modalName","go","isModalOpen","requestCloseModal","onRequestCloseModal","setDarkModeCapability","isDarkModeOn","getState","capabilities","setState","darkMode","handleSystemDarkModeChange","event","isDarkModeOnNow","matches","toggleFileCard","fileId","toggleAddFilesPanel","show","addFiles","files","descriptors","map","source","data","meta","relativePath","err","startListeningToResize","resizeObserver","entries","observer","uppyDashboardInnerEl","contentRect","width","height","containerWidth","containerHeight","areInsidesReadyToBeVisible","observe","querySelector","makeDashboardInsidesVisibleAnywayTimeout","setTimeout","isModalAndClosed","inline","stopListeningToResize","disconnect","clearTimeout","recordIfFocusedOnUppyRecently","contains","ifFocusedOnUppyRecently","pushState","handlePopState","keyCode","forModal","handleClickOutside","closeModalOnClickOutside","handlePaste","iteratePlugins","handleRootPaste","clipboardData","handleInputChange","preventDefault","handleDragOver","stopPropagation","dataTransfer","dropEffect","removeDragOverClassTimeout","isDraggingOver","handleDragLeave","handleDrop","dropCategory","handleRootDrop","executedDropErrorOnce","logDropError","error","info","message","then","length","handleRequestThumbnail","waitForThumbnailsBeforeUpload","handleCancelThumbnail","handleKeyDownInInline","forInline","handlePasteOnBody","isFocusInOverlay","handleComplete","failed","uploadID","closeAfterFinish","initEvents","trigger","showModalTrigger","on","removeEvents","off","superFocusOnEachUpdate","isFocusInUppy","isFocusNowhere","isInformerHidden","isModal","afterUpdate","cancelUpload","fileID","removeFile","saveFileCard","setFileMeta","_attachRenderFunctionToTarget","icon","render","_isTargetSupported","isSupported","_getAcquirers","_getProgressIndicators","allowNewUpload","newFiles","Object","keys","progress","uploadStarted","uploadStartedFiles","pausedFiles","isPaused","completeFiles","uploadComplete","erroredFiles","inProgressFiles","inProgressNotPausedFiles","processingFiles","preprocess","postprocess","isUploadStarted","isAllComplete","totalProgress","isAllErrored","isAllPaused","acquirers","progressindicators","theme","indexOf","fileManagerSelectionType","console","totalFileCount","autoProceed","note","metaFields","resumableUploads","individualCancellation","isMobileDevice","pauseUpload","pauseResume","retryUpload","cancelAll","showLinkToFileUploadResult","proudlyDisplayPoweredByUppy","hideCancelButton","hideRetryButton","hidePauseResumeButton","showRemoveButtonAfterComplete","isTargetDOMEl","parentElement","allowedFileTypes","restrictions","maxNumberOfFiles","showSelectedFiles","discoverProviderPlugins","install","Error","allowMultipleUploads","mount","plugins","pluginID","disableStatusBar","use","hideUploadButton","showProgressDetails","hideAfterFinish","hideProgressAfterFinish","doneButtonHandler","disableInformer","disableThumbnailGenerator","thumbnailWidth","thumbnailType","lazy","darkModeMediaQuery","matchMedia","isDarkModeOnFromTheStart","addListener","uninstall","informer","removePlugin","statusBar","thumbnail","unmount","removeListener","strings","importFrom","addingMoreFiles","addMoreFiles","dashboardWindowTitle","dashboardTitle","copyLinkToClipboardSuccess","copyLinkToClipboardFallback","copyLink","fileSource","done","back","addMore","editFile","editing","finishEditingFile","saveChanges","myDevice","dropPasteFiles","dropPasteFolders","dropPasteBoth","dropPasteImportFiles","dropPasteImportFolders","dropPasteImportBoth","dropHint","browseFiles","browseFolders","uploadPaused","resumeUpload","xFilesSelected","uploadingXFiles","processingXFiles","poweredBy2","poweredBy","defaultOptions","reset","VERSION"],"mappings":"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","sourcesContent":["const { h } = require('preact')\nconst { Plugin } = require('@uppy/core')\nconst Translator = require('@uppy/utils/lib/Translator')\nconst DashboardUI = require('./components/Dashboard')\nconst StatusBar = require('@uppy/status-bar')\nconst Informer = require('@uppy/informer')\nconst ThumbnailGenerator = require('@uppy/thumbnail-generator')\nconst findAllDOMElements = require('@uppy/utils/lib/findAllDOMElements')\nconst toArray = require('@uppy/utils/lib/toArray')\nconst getDroppedFiles = require('@uppy/utils/lib/getDroppedFiles')\nconst trapFocus = require('./utils/trapFocus')\nconst cuid = require('cuid')\nconst ResizeObserver = require('resize-observer-polyfill').default || require('resize-observer-polyfill')\nconst createSuperFocus = require('./utils/createSuperFocus')\nconst memoize = require('memoize-one').default || require('memoize-one')\n\nconst TAB_KEY = 9\nconst ESC_KEY = 27\n\nfunction createPromise () {\n  const o = {}\n  o.promise = new Promise((resolve, reject) => {\n    o.resolve = resolve\n    o.reject = reject\n  })\n  return o\n}\n\nfunction defaultPickerIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\">\n      <path d=\"M15 30c8.284 0 15-6.716 15-15 0-8.284-6.716-15-15-15C6.716 0 0 6.716 0 15c0 8.284 6.716 15 15 15zm4.258-12.676v6.846h-8.426v-6.846H5.204l9.82-12.364 9.82 12.364H19.26z\" />\n    </svg>\n  )\n}\n\n/**\n * Dashboard UI with previews, metadata editing, tabs for various services and more\n */\nmodule.exports = class Dashboard extends Plugin {\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Dashboard'\n    this.title = 'Dashboard'\n    this.type = 'orchestrator'\n    this.modalName = `uppy-Dashboard-${cuid()}`\n\n    this.defaultLocale = {\n      strings: {\n        closeModal: 'Close Modal',\n        importFrom: 'Import from %{name}',\n        addingMoreFiles: 'Adding more files',\n        addMoreFiles: 'Add more files',\n        dashboardWindowTitle: 'File Uploader Window (Press escape to close)',\n        dashboardTitle: 'File Uploader',\n        copyLinkToClipboardSuccess: 'Link copied to clipboard',\n        copyLinkToClipboardFallback: 'Copy the URL below',\n        copyLink: 'Copy link',\n        fileSource: 'File source: %{name}',\n        done: 'Done',\n        back: 'Back',\n        addMore: 'Add more',\n        removeFile: 'Remove file',\n        editFile: 'Edit file',\n        editing: 'Editing %{file}',\n        finishEditingFile: 'Finish editing file',\n        saveChanges: 'Save changes',\n        cancel: 'Cancel',\n        myDevice: 'My Device',\n        dropPasteFiles: 'Drop files here, paste or %{browseFiles}',\n        dropPasteFolders: 'Drop files here, paste or %{browseFolders}',\n        dropPasteBoth: 'Drop files here, paste, %{browseFiles} or %{browseFolders}',\n        dropPasteImportFiles: 'Drop files here, paste, %{browseFiles} or import from:',\n        dropPasteImportFolders: 'Drop files here, paste, %{browseFolders} or import from:',\n        dropPasteImportBoth: 'Drop files here, paste, %{browseFiles}, %{browseFolders} or import from:',\n        dropHint: 'Drop your files here',\n        browseFiles: 'browse files',\n        browseFolders: 'browse folders',\n        uploadComplete: 'Upload complete',\n        uploadPaused: 'Upload paused',\n        resumeUpload: 'Resume upload',\n        pauseUpload: 'Pause upload',\n        retryUpload: 'Retry upload',\n        cancelUpload: 'Cancel upload',\n        xFilesSelected: {\n          0: '%{smart_count} file selected',\n          1: '%{smart_count} files selected'\n        },\n        uploadingXFiles: {\n          0: 'Uploading %{smart_count} file',\n          1: 'Uploading %{smart_count} files'\n        },\n        processingXFiles: {\n          0: 'Processing %{smart_count} file',\n          1: 'Processing %{smart_count} files'\n        },\n        // The default `poweredBy2` string only combines the `poweredBy` string (%{backwardsCompat}) with the size.\n        // Locales can override `poweredBy2` to specify a different word order. This is for backwards compat with\n        // Uppy 1.9.x and below which did a naive concatenation of `poweredBy2 + size` instead of using a locale-specific\n        // substitution.\n        // TODO: In 2.0 `poweredBy2` should be removed in and `poweredBy` updated to use substitution.\n        poweredBy2: '%{backwardsCompat} %{uppy}',\n        poweredBy: 'Powered by'\n      }\n    }\n\n    // set default options\n    const defaultOptions = {\n      target: 'body',\n      metaFields: [],\n      trigger: '#uppy-select-files',\n      inline: false,\n      width: 750,\n      height: 550,\n      thumbnailWidth: 280,\n      thumbnailType: 'image/jpeg',\n      waitForThumbnailsBeforeUpload: false,\n      defaultPickerIcon,\n      showLinkToFileUploadResult: true,\n      showProgressDetails: false,\n      hideUploadButton: false,\n      hideCancelButton: false,\n      hideRetryButton: false,\n      hidePauseResumeButton: false,\n      hideProgressAfterFinish: false,\n      doneButtonHandler: () => {\n        this.uppy.reset()\n        this.requestCloseModal()\n      },\n      note: null,\n      closeModalOnClickOutside: false,\n      closeAfterFinish: false,\n      disableStatusBar: false,\n      disableInformer: false,\n      disableThumbnailGenerator: false,\n      disablePageScrollWhenModalOpen: true,\n      animateOpenClose: true,\n      fileManagerSelectionType: 'files',\n      proudlyDisplayPoweredByUppy: true,\n      onRequestCloseModal: () => this.closeModal(),\n      showSelectedFiles: true,\n      showRemoveButtonAfterComplete: false,\n      browserBackButtonClose: false,\n      theme: 'light'\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.superFocus = createSuperFocus()\n    this.ifFocusedOnUppyRecently = false\n\n    // Timeouts\n    this.makeDashboardInsidesVisibleAnywayTimeout = null\n    this.removeDragOverClassTimeout = null\n  }\n\n  setOptions = (newOpts) => {\n    super.setOptions(newOpts)\n    this.i18nInit()\n  }\n\n  i18nInit = () => {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale])\n    this.i18n = this.translator.translate.bind(this.translator)\n    this.i18nArray = this.translator.translateArray.bind(this.translator)\n    this.setPluginState() // so that UI re-renders and we see the updated locale\n  }\n\n  removeTarget = (plugin) => {\n    const pluginState = this.getPluginState()\n    // filter out the one we want to remove\n    const newTargets = pluginState.targets.filter(target => target.id !== plugin.id)\n\n    this.setPluginState({\n      targets: newTargets\n    })\n  }\n\n  addTarget = (plugin) => {\n    const callerPluginId = plugin.id || plugin.constructor.name\n    const callerPluginName = plugin.title || callerPluginId\n    const callerPluginType = plugin.type\n\n    if (callerPluginType !== 'acquirer' &&\n        callerPluginType !== 'progressindicator' &&\n        callerPluginType !== 'editor') {\n      const msg = 'Dashboard: can only be targeted by plugins of types: acquirer, progressindicator, editor'\n      this.uppy.log(msg, 'error')\n      return\n    }\n\n    const target = {\n      id: callerPluginId,\n      name: callerPluginName,\n      type: callerPluginType\n    }\n\n    const state = this.getPluginState()\n    const newTargets = state.targets.slice()\n    newTargets.push(target)\n\n    this.setPluginState({\n      targets: newTargets\n    })\n\n    return this.el\n  }\n\n  hideAllPanels = () => {\n    const update = {\n      activePickerPanel: false,\n      showAddFilesPanel: false,\n      activeOverlayType: null,\n      fileCardFor: null,\n      showFileEditor: false\n    }\n\n    const current = this.getPluginState()\n    if (current.activePickerPanel === update.activePickerPanel &&\n        current.showAddFilesPanel === update.showAddFilesPanel &&\n        current.showFileEditor === update.showFileEditor &&\n        current.activeOverlayType === update.activeOverlayType) {\n      // avoid doing a state update if nothing changed\n      return\n    }\n\n    this.setPluginState(update)\n  }\n\n  showPanel = (id) => {\n    const { targets } = this.getPluginState()\n\n    const activePickerPanel = targets.filter((target) => {\n      return target.type === 'acquirer' && target.id === id\n    })[0]\n\n    this.setPluginState({\n      activePickerPanel: activePickerPanel,\n      activeOverlayType: 'PickerPanel'\n    })\n  }\n\n  canEditFile = (file) => {\n    const { targets } = this.getPluginState()\n    const editors = this._getEditors(targets)\n\n    return editors.some((target) => (\n      this.uppy.getPlugin(target.id).canEditFile(file)\n    ))\n  }\n\n  openFileEditor = (file) => {\n    const { targets } = this.getPluginState()\n    const editors = this._getEditors(targets)\n\n    this.setPluginState({\n      showFileEditor: true,\n      fileCardFor: file.id || null,\n      activeOverlayType: 'FileEditor'\n    })\n\n    editors.forEach((editor) => {\n      this.uppy.getPlugin(editor.id).selectFile(file)\n    })\n  }\n\n  openModal = () => {\n    const { promise, resolve } = createPromise()\n    // save scroll position\n    this.savedScrollPosition = window.pageYOffset\n    // save active element, so we can restore focus when modal is closed\n    this.savedActiveElement = document.activeElement\n\n    if (this.opts.disablePageScrollWhenModalOpen) {\n      document.body.classList.add('uppy-Dashboard-isFixed')\n    }\n\n    if (this.opts.animateOpenClose && this.getPluginState().isClosing) {\n      const handler = () => {\n        this.setPluginState({\n          isHidden: false\n        })\n        this.el.removeEventListener('animationend', handler, false)\n        resolve()\n      }\n      this.el.addEventListener('animationend', handler, false)\n    } else {\n      this.setPluginState({\n        isHidden: false\n      })\n      resolve()\n    }\n\n    if (this.opts.browserBackButtonClose) {\n      this.updateBrowserHistory()\n    }\n\n    // handle ESC and TAB keys in modal dialog\n    document.addEventListener('keydown', this.handleKeyDownInModal)\n\n    this.uppy.emit('dashboard:modal-open')\n\n    return promise\n  }\n\n  closeModal = (opts = {}) => {\n    const {\n      manualClose = true // Whether the modal is being closed by the user (`true`) or by other means (e.g. browser back button)\n    } = opts\n\n    const { isHidden, isClosing } = this.getPluginState()\n    if (isHidden || isClosing) {\n      // short-circuit if animation is ongoing\n      return\n    }\n\n    const { promise, resolve } = createPromise()\n\n    if (this.opts.disablePageScrollWhenModalOpen) {\n      document.body.classList.remove('uppy-Dashboard-isFixed')\n    }\n\n    if (this.opts.animateOpenClose) {\n      this.setPluginState({\n        isClosing: true\n      })\n      const handler = () => {\n        this.setPluginState({\n          isHidden: true,\n          isClosing: false\n        })\n\n        this.superFocus.cancel()\n        this.savedActiveElement.focus()\n\n        this.el.removeEventListener('animationend', handler, false)\n        resolve()\n      }\n      this.el.addEventListener('animationend', handler, false)\n    } else {\n      this.setPluginState({\n        isHidden: true\n      })\n\n      this.superFocus.cancel()\n      this.savedActiveElement.focus()\n\n      resolve()\n    }\n\n    // handle ESC and TAB keys in modal dialog\n    document.removeEventListener('keydown', this.handleKeyDownInModal)\n\n    if (manualClose) {\n      if (this.opts.browserBackButtonClose) {\n        // Make sure that the latest entry in the history state is our modal name\n        if (history.state && history.state[this.modalName]) {\n          // Go back in history to clear out the entry we created (ultimately closing the modal)\n          history.go(-1)\n        }\n      }\n    }\n\n    this.uppy.emit('dashboard:modal-closed')\n\n    return promise\n  }\n\n  isModalOpen = () => {\n    return !this.getPluginState().isHidden || false\n  }\n\n  requestCloseModal = () => {\n    if (this.opts.onRequestCloseModal) {\n      return this.opts.onRequestCloseModal()\n    }\n    return this.closeModal()\n  }\n\n  setDarkModeCapability = (isDarkModeOn) => {\n    const { capabilities } = this.uppy.getState()\n    this.uppy.setState({\n      capabilities: {\n        ...capabilities,\n        darkMode: isDarkModeOn\n      }\n    })\n  }\n\n  handleSystemDarkModeChange = (event) => {\n    const isDarkModeOnNow = event.matches\n    this.uppy.log(`[Dashboard] Dark mode is ${isDarkModeOnNow ? 'on' : 'off'}`)\n    this.setDarkModeCapability(isDarkModeOnNow)\n  }\n\n  toggleFileCard = (fileId) => {\n    if (fileId) {\n      this.uppy.emit('dashboard:file-edit-start')\n    } else {\n      this.uppy.emit('dashboard:file-edit-complete')\n    }\n\n    this.setPluginState({\n      fileCardFor: fileId || null,\n      activeOverlayType: fileId ? 'FileCard' : null\n    })\n  }\n\n  toggleAddFilesPanel = (show) => {\n    this.setPluginState({\n      showAddFilesPanel: show,\n      activeOverlayType: show ? 'AddFiles' : null\n    })\n  }\n\n  addFiles = (files) => {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null\n      }\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  // ___Why make insides of Dashboard invisible until first ResizeObserver event is emitted?\n  //    ResizeOberserver doesn't emit the first resize event fast enough, users can see the jump from one .uppy-size-- to another (e.g. in Safari)\n  // ___Why not apply visibility property to .uppy-Dashboard-inner?\n  //    Because ideally, acc to specs, ResizeObserver should see invisible elements as of width 0. So even though applying invisibility to .uppy-Dashboard-inner works now, it may not work in the future.\n  startListeningToResize = () => {\n    // Watch for Dashboard container (`.uppy-Dashboard-inner`) resize\n    // and update containerWidth/containerHeight in plugin state accordingly.\n    // Emits first event on initialization.\n    this.resizeObserver = new ResizeObserver((entries, observer) => {\n      const uppyDashboardInnerEl = entries[0]\n\n      const { width, height } = uppyDashboardInnerEl.contentRect\n\n      this.uppy.log(`[Dashboard] resized: ${width} / ${height}`, 'debug')\n\n      this.setPluginState({\n        containerWidth: width,\n        containerHeight: height,\n        areInsidesReadyToBeVisible: true\n      })\n    })\n    this.resizeObserver.observe(this.el.querySelector('.uppy-Dashboard-inner'))\n\n    // If ResizeObserver fails to emit an event telling us what size to use - default to the mobile view\n    this.makeDashboardInsidesVisibleAnywayTimeout = setTimeout(() => {\n      const pluginState = this.getPluginState()\n      const isModalAndClosed = !this.opts.inline && pluginState.isHidden\n      if (\n        // if ResizeObserver hasn't yet fired,\n        !pluginState.areInsidesReadyToBeVisible &&\n        // and it's not due to the modal being closed\n        !isModalAndClosed\n      ) {\n        this.uppy.log(\"[Dashboard] resize event didn't fire on time: defaulted to mobile layout\", 'debug')\n\n        this.setPluginState({\n          areInsidesReadyToBeVisible: true\n        })\n      }\n    }, 1000)\n  }\n\n  stopListeningToResize = () => {\n    this.resizeObserver.disconnect()\n\n    clearTimeout(this.makeDashboardInsidesVisibleAnywayTimeout)\n  }\n\n  // Records whether we have been interacting with uppy right now, which is then used to determine whether state updates should trigger a refocusing.\n  recordIfFocusedOnUppyRecently = (event) => {\n    if (this.el.contains(event.target)) {\n      this.ifFocusedOnUppyRecently = true\n    } else {\n      this.ifFocusedOnUppyRecently = false\n      // ___Why run this.superFocus.cancel here when it already runs in superFocusOnEachUpdate?\n      //    Because superFocus is debounced, when we move from Uppy to some other element on the page,\n      //    previously run superFocus sometimes hits and moves focus back to Uppy.\n      this.superFocus.cancel()\n    }\n  }\n\n  updateBrowserHistory = () => {\n    // Ensure history state does not already contain our modal name to avoid double-pushing\n    if (!history.state || !history.state[this.modalName]) {\n      // Push to history so that the page is not lost on browser back button press\n      history.pushState({\n        ...history.state,\n        [this.modalName]: true\n      }, '')\n    }\n\n    // Listen for back button presses\n    window.addEventListener('popstate', this.handlePopState, false)\n  }\n\n  handlePopState = (event) => {\n    // Close the modal if the history state no longer contains our modal name\n    if (this.isModalOpen() && (!event.state || !event.state[this.modalName])) {\n      this.closeModal({ manualClose: false })\n    }\n\n    // When the browser back button is pressed and uppy is now the latest entry in the history but the modal is closed, fix the history by removing the uppy history entry\n    // This occurs when another entry is added into the history state while the modal is open, and then the modal gets manually closed\n    // Solves PR #575 (https://github.com/transloadit/uppy/pull/575)\n    if (!this.isModalOpen() && event.state && event.state[this.modalName]) {\n      history.go(-1)\n    }\n  }\n\n  handleKeyDownInModal = (event) => {\n    // close modal on esc key press\n    if (event.keyCode === ESC_KEY) this.requestCloseModal(event)\n    // trap focus on tab key press\n    if (event.keyCode === TAB_KEY) trapFocus.forModal(event, this.getPluginState().activeOverlayType, this.el)\n  }\n\n  handleClickOutside = () => {\n    if (this.opts.closeModalOnClickOutside) this.requestCloseModal()\n  }\n\n  handlePaste = (event) => {\n    // 1. Let any acquirer plugin (Url/Webcam/etc.) handle pastes to the root\n    this.uppy.iteratePlugins((plugin) => {\n      if (plugin.type === 'acquirer') {\n        // Every Plugin with .type acquirer can define handleRootPaste(event)\n        plugin.handleRootPaste && plugin.handleRootPaste(event)\n      }\n    })\n\n    // 2. Add all dropped files\n    const files = toArray(event.clipboardData.files)\n    this.addFiles(files)\n  }\n\n  handleInputChange = (event) => {\n    event.preventDefault()\n    const files = toArray(event.target.files)\n    this.addFiles(files)\n  }\n\n  handleDragOver = (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // 1. Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser, https://github.com/transloadit/uppy/issues/1978)\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n  }\n\n  handleDragLeave = (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library. Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n  }\n\n  handleDrop = (event, dropCategory) => {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // 2. Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    // 3. Let any acquirer plugin (Url/Webcam/etc.) handle drops to the root\n    this.uppy.iteratePlugins((plugin) => {\n      if (plugin.type === 'acquirer') {\n        // Every Plugin with .type acquirer can define handleRootDrop(event)\n        plugin.handleRootDrop && plugin.handleRootDrop(event)\n      }\n    })\n\n    // 4. Add all dropped files\n    let executedDropErrorOnce = false\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n\n      // In practice all drop errors are most likely the same, so let's just show one to avoid overwhelming the user\n      if (!executedDropErrorOnce) {\n        this.uppy.info(error.message, 'error')\n        executedDropErrorOnce = true\n      }\n    }\n\n    getDroppedFiles(event.dataTransfer, { logDropError })\n      .then((files) => {\n        if (files.length > 0) {\n          this.uppy.log('[Dashboard] Files were dropped')\n          this.addFiles(files)\n        }\n      })\n  }\n\n  handleRequestThumbnail = (file) => {\n    if (!this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.emit('thumbnail:request', file)\n    }\n  }\n\n  /**\n   * We cancel thumbnail requests when a file item component unmounts to avoid clogging up the queue when the user scrolls past many elements.\n   */\n  handleCancelThumbnail = (file) => {\n    if (!this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.emit('thumbnail:cancel', file)\n    }\n  }\n\n  handleKeyDownInInline = (event) => {\n    // Trap focus on tab key press.\n    if (event.keyCode === TAB_KEY) trapFocus.forInline(event, this.getPluginState().activeOverlayType, this.el)\n  }\n\n  // ___Why do we listen to the 'paste' event on a document instead of onPaste={props.handlePaste} prop, or this.el.addEventListener('paste')?\n  //    Because (at least) Chrome doesn't handle paste if focus is on some button, e.g. 'My Device'.\n  //    => Therefore, the best option is to listen to all 'paste' events, and only react to them when we are focused on our particular Uppy instance.\n  // ___Why do we still need onPaste={props.handlePaste} for the DashboardUi?\n  //    Because if we click on the 'Drop files here' caption e.g., `document.activeElement` will be 'body'. Which means our standard determination of whether we're pasting into our Uppy instance won't work.\n  //    => Therefore, we need a traditional onPaste={props.handlePaste} handler too.\n  handlePasteOnBody = (event) => {\n    const isFocusInOverlay = this.el.contains(document.activeElement)\n    if (isFocusInOverlay) {\n      this.handlePaste(event)\n    }\n  }\n\n  handleComplete = ({ failed, uploadID }) => {\n    if (this.opts.closeAfterFinish && failed.length === 0) {\n      // All uploads are done\n      this.requestCloseModal()\n    }\n  }\n\n  initEvents = () => {\n    // Modal open button\n    if (this.opts.trigger && !this.opts.inline) {\n      const showModalTrigger = findAllDOMElements(this.opts.trigger)\n      if (showModalTrigger) {\n        showModalTrigger.forEach(trigger => trigger.addEventListener('click', this.openModal))\n      } else {\n        this.uppy.log('Dashboard modal trigger not found. Make sure `trigger` is set in Dashboard options, unless you are planning to call `dashboard.openModal()` method yourself', 'warning')\n      }\n    }\n\n    this.startListeningToResize()\n    document.addEventListener('paste', this.handlePasteOnBody)\n\n    this.uppy.on('plugin-remove', this.removeTarget)\n    this.uppy.on('file-added', this.hideAllPanels)\n    this.uppy.on('dashboard:modal-closed', this.hideAllPanels)\n    this.uppy.on('file-editor:complete', this.hideAllPanels)\n    this.uppy.on('complete', this.handleComplete)\n\n    // ___Why fire on capture?\n    //    Because this.ifFocusedOnUppyRecently needs to change before onUpdate() fires.\n    document.addEventListener('focus', this.recordIfFocusedOnUppyRecently, true)\n    document.addEventListener('click', this.recordIfFocusedOnUppyRecently, true)\n\n    if (this.opts.inline) {\n      this.el.addEventListener('keydown', this.handleKeyDownInInline)\n    }\n  }\n\n  removeEvents = () => {\n    const showModalTrigger = findAllDOMElements(this.opts.trigger)\n    if (!this.opts.inline && showModalTrigger) {\n      showModalTrigger.forEach(trigger => trigger.removeEventListener('click', this.openModal))\n    }\n\n    this.stopListeningToResize()\n    document.removeEventListener('paste', this.handlePasteOnBody)\n\n    window.removeEventListener('popstate', this.handlePopState, false)\n    this.uppy.off('plugin-remove', this.removeTarget)\n    this.uppy.off('file-added', this.hideAllPanels)\n    this.uppy.off('dashboard:modal-closed', this.hideAllPanels)\n    this.uppy.off('complete', this.handleComplete)\n\n    document.removeEventListener('focus', this.recordIfFocusedOnUppyRecently)\n    document.removeEventListener('click', this.recordIfFocusedOnUppyRecently)\n\n    if (this.opts.inline) {\n      this.el.removeEventListener('keydown', this.handleKeyDownInInline)\n    }\n  }\n\n  superFocusOnEachUpdate = () => {\n    const isFocusInUppy = this.el.contains(document.activeElement)\n    // When focus is lost on the page (== focus is on body for most browsers, or focus is null for IE11)\n    const isFocusNowhere = document.activeElement === document.body || document.activeElement === null\n    const isInformerHidden = this.uppy.getState().info.isHidden\n    const isModal = !this.opts.inline\n\n    if (\n      // If update is connected to showing the Informer - let the screen reader calmly read it.\n      isInformerHidden &&\n      (\n        // If we are in a modal - always superfocus without concern for other elements on the page (user is unlikely to want to interact with the rest of the page)\n        isModal ||\n        // If we are already inside of Uppy, or\n        isFocusInUppy ||\n        // If we are not focused on anything BUT we have already, at least once, focused on uppy\n        //   1. We focus when isFocusNowhere, because when the element we were focused on disappears (e.g. an overlay), - focus gets lost. If user is typing something somewhere else on the page, - focus won't be 'nowhere'.\n        //   2. We only focus when focus is nowhere AND this.ifFocusedOnUppyRecently, to avoid focus jumps if we do something else on the page.\n        //   [Practical check] Without '&& this.ifFocusedOnUppyRecently', in Safari, in inline mode, when file is uploading, - navigate via tab to the checkbox, try to press space multiple times. Focus will jump to Uppy.\n        (isFocusNowhere && this.ifFocusedOnUppyRecently)\n      )\n    ) {\n      this.superFocus(this.el, this.getPluginState().activeOverlayType)\n    } else {\n      this.superFocus.cancel()\n    }\n  }\n\n  afterUpdate = () => {\n    this.superFocusOnEachUpdate()\n  }\n\n  cancelUpload = (fileID) => {\n    this.uppy.removeFile(fileID)\n  }\n\n  saveFileCard = (meta, fileID) => {\n    this.uppy.setFileMeta(fileID, meta)\n    this.toggleFileCard()\n  }\n\n  _attachRenderFunctionToTarget = (target) => {\n    const plugin = this.uppy.getPlugin(target.id)\n    return {\n      ...target,\n      icon: plugin.icon || this.opts.defaultPickerIcon,\n      render: plugin.render\n    }\n  }\n\n  _isTargetSupported = (target) => {\n    const plugin = this.uppy.getPlugin(target.id)\n    // If the plugin does not provide a `supported` check, assume the plugin works everywhere.\n    if (typeof plugin.isSupported !== 'function') {\n      return true\n    }\n    return plugin.isSupported()\n  }\n\n  _getAcquirers = memoize((targets) => {\n    return targets\n      .filter(target => target.type === 'acquirer' && this._isTargetSupported(target))\n      .map(this._attachRenderFunctionToTarget)\n  })\n\n  _getProgressIndicators = memoize((targets) => {\n    return targets\n      .filter(target => target.type === 'progressindicator')\n      .map(this._attachRenderFunctionToTarget)\n  })\n\n  _getEditors = memoize((targets) => {\n    return targets\n      .filter(target => target.type === 'editor')\n      .map(this._attachRenderFunctionToTarget)\n  })\n\n  render = (state) => {\n    const pluginState = this.getPluginState()\n    const { files, capabilities, allowNewUpload } = state\n\n    // TODO: move this to Core, to share between Status Bar and Dashboard\n    // (and any other plugin that might need it, too)\n    const newFiles = Object.keys(files).filter((file) => {\n      return !files[file].progress.uploadStarted\n    })\n\n    const uploadStartedFiles = Object.keys(files).filter((file) => {\n      return files[file].progress.uploadStarted\n    })\n\n    const pausedFiles = Object.keys(files).filter((file) => {\n      return files[file].isPaused\n    })\n\n    const completeFiles = Object.keys(files).filter((file) => {\n      return files[file].progress.uploadComplete\n    })\n\n    const erroredFiles = Object.keys(files).filter((file) => {\n      return files[file].error\n    })\n\n    const inProgressFiles = Object.keys(files).filter((file) => {\n      return !files[file].progress.uploadComplete &&\n             files[file].progress.uploadStarted\n    })\n\n    const inProgressNotPausedFiles = inProgressFiles.filter((file) => {\n      return !files[file].isPaused\n    })\n\n    const processingFiles = Object.keys(files).filter((file) => {\n      return files[file].progress.preprocess || files[file].progress.postprocess\n    })\n\n    const isUploadStarted = uploadStartedFiles.length > 0\n\n    const isAllComplete = state.totalProgress === 100 &&\n      completeFiles.length === Object.keys(files).length &&\n      processingFiles.length === 0\n\n    const isAllErrored = isUploadStarted &&\n      erroredFiles.length === uploadStartedFiles.length\n\n    const isAllPaused = inProgressFiles.length !== 0 &&\n      pausedFiles.length === inProgressFiles.length\n\n    const acquirers = this._getAcquirers(pluginState.targets)\n    const progressindicators = this._getProgressIndicators(pluginState.targets)\n    const editors = this._getEditors(pluginState.targets)\n\n    let theme\n    if (this.opts.theme === 'auto') {\n      theme = capabilities.darkMode ? 'dark' : 'light'\n    } else {\n      theme = this.opts.theme\n    }\n\n    if (['files', 'folders', 'both'].indexOf(this.opts.fileManagerSelectionType) < 0) {\n      this.opts.fileManagerSelectionType = 'files'\n      console.error(`Unsupported option for \"fileManagerSelectionType\". Using default of \"${this.opts.fileManagerSelectionType}\".`)\n    }\n\n    return DashboardUI({\n      state,\n      isHidden: pluginState.isHidden,\n      files,\n      newFiles,\n      uploadStartedFiles,\n      completeFiles,\n      erroredFiles,\n      inProgressFiles,\n      inProgressNotPausedFiles,\n      processingFiles,\n      isUploadStarted,\n      isAllComplete,\n      isAllErrored,\n      isAllPaused,\n      totalFileCount: Object.keys(files).length,\n      totalProgress: state.totalProgress,\n      allowNewUpload,\n      acquirers,\n      theme,\n      activePickerPanel: pluginState.activePickerPanel,\n      showFileEditor: pluginState.showFileEditor,\n      animateOpenClose: this.opts.animateOpenClose,\n      isClosing: pluginState.isClosing,\n      getPlugin: this.uppy.getPlugin,\n      progressindicators: progressindicators,\n      editors: editors,\n      autoProceed: this.uppy.opts.autoProceed,\n      id: this.id,\n      closeModal: this.requestCloseModal,\n      handleClickOutside: this.handleClickOutside,\n      handleInputChange: this.handleInputChange,\n      handlePaste: this.handlePaste,\n      inline: this.opts.inline,\n      showPanel: this.showPanel,\n      hideAllPanels: this.hideAllPanels,\n      log: this.uppy.log,\n      i18n: this.i18n,\n      i18nArray: this.i18nArray,\n      removeFile: this.uppy.removeFile,\n      uppy: this.uppy,\n      info: this.uppy.info,\n      note: this.opts.note,\n      metaFields: pluginState.metaFields,\n      resumableUploads: capabilities.resumableUploads || false,\n      individualCancellation: capabilities.individualCancellation,\n      isMobileDevice: capabilities.isMobileDevice,\n      pauseUpload: this.uppy.pauseResume,\n      retryUpload: this.uppy.retryUpload,\n      cancelUpload: this.cancelUpload,\n      cancelAll: this.uppy.cancelAll,\n      fileCardFor: pluginState.fileCardFor,\n      toggleFileCard: this.toggleFileCard,\n      toggleAddFilesPanel: this.toggleAddFilesPanel,\n      showAddFilesPanel: pluginState.showAddFilesPanel,\n      saveFileCard: this.saveFileCard,\n      openFileEditor: this.openFileEditor,\n      canEditFile: this.canEditFile,\n      width: this.opts.width,\n      height: this.opts.height,\n      showLinkToFileUploadResult: this.opts.showLinkToFileUploadResult,\n      fileManagerSelectionType: this.opts.fileManagerSelectionType,\n      proudlyDisplayPoweredByUppy: this.opts.proudlyDisplayPoweredByUppy,\n      hideCancelButton: this.opts.hideCancelButton,\n      hideRetryButton: this.opts.hideRetryButton,\n      hidePauseResumeButton: this.opts.hidePauseResumeButton,\n      showRemoveButtonAfterComplete: this.opts.showRemoveButtonAfterComplete,\n      containerWidth: pluginState.containerWidth,\n      containerHeight: pluginState.containerHeight,\n      areInsidesReadyToBeVisible: pluginState.areInsidesReadyToBeVisible,\n      isTargetDOMEl: this.isTargetDOMEl,\n      parentElement: this.el,\n      allowedFileTypes: this.uppy.opts.restrictions.allowedFileTypes,\n      maxNumberOfFiles: this.uppy.opts.restrictions.maxNumberOfFiles,\n      showSelectedFiles: this.opts.showSelectedFiles,\n      handleRequestThumbnail: this.handleRequestThumbnail,\n      handleCancelThumbnail: this.handleCancelThumbnail,\n      // drag props\n      isDraggingOver: pluginState.isDraggingOver,\n      handleDragOver: this.handleDragOver,\n      handleDragLeave: this.handleDragLeave,\n      handleDrop: this.handleDrop\n    })\n  }\n\n  discoverProviderPlugins = () => {\n    this.uppy.iteratePlugins((plugin) => {\n      if (plugin && !plugin.target && plugin.opts && plugin.opts.target === this.constructor) {\n        this.addTarget(plugin)\n      }\n    })\n  }\n\n  install = () => {\n    // Set default state for Dashboard\n    this.setPluginState({\n      isHidden: true,\n      fileCardFor: null,\n      activeOverlayType: null,\n      showAddFilesPanel: false,\n      activePickerPanel: false,\n      showFileEditor: false,\n      metaFields: this.opts.metaFields,\n      targets: [],\n      // We'll make them visible once .containerWidth is determined\n      areInsidesReadyToBeVisible: false,\n      isDraggingOver: false\n    })\n\n    const { inline, closeAfterFinish } = this.opts\n    if (inline && closeAfterFinish) {\n      throw new Error('[Dashboard] `closeAfterFinish: true` cannot be used on an inline Dashboard, because an inline Dashboard cannot be closed at all. Either set `inline: false`, or disable the `closeAfterFinish` option.')\n    }\n\n    const { allowMultipleUploads } = this.uppy.opts\n    if (allowMultipleUploads && closeAfterFinish) {\n      this.uppy.log('[Dashboard] When using `closeAfterFinish`, we recommended setting the `allowMultipleUploads` option to `false` in the Uppy constructor. See https://uppy.io/docs/uppy/#allowMultipleUploads-true', 'warning')\n    }\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n\n    const plugins = this.opts.plugins || []\n    plugins.forEach((pluginID) => {\n      const plugin = this.uppy.getPlugin(pluginID)\n      if (plugin) {\n        plugin.mount(this, plugin)\n      }\n    })\n\n    if (!this.opts.disableStatusBar) {\n      this.uppy.use(StatusBar, {\n        id: `${this.id}:StatusBar`,\n        target: this,\n        hideUploadButton: this.opts.hideUploadButton,\n        hideRetryButton: this.opts.hideRetryButton,\n        hidePauseResumeButton: this.opts.hidePauseResumeButton,\n        hideCancelButton: this.opts.hideCancelButton,\n        showProgressDetails: this.opts.showProgressDetails,\n        hideAfterFinish: this.opts.hideProgressAfterFinish,\n        locale: this.opts.locale,\n        doneButtonHandler: this.opts.doneButtonHandler\n      })\n    }\n\n    if (!this.opts.disableInformer) {\n      this.uppy.use(Informer, {\n        id: `${this.id}:Informer`,\n        target: this\n      })\n    }\n\n    if (!this.opts.disableThumbnailGenerator) {\n      this.uppy.use(ThumbnailGenerator, {\n        id: `${this.id}:ThumbnailGenerator`,\n        thumbnailWidth: this.opts.thumbnailWidth,\n        thumbnailType: this.opts.thumbnailType,\n        waitForThumbnailsBeforeUpload: this.opts.waitForThumbnailsBeforeUpload,\n        // If we don't block on thumbnails, we can lazily generate them\n        lazy: !this.opts.waitForThumbnailsBeforeUpload\n      })\n    }\n\n    // Dark Mode / theme\n    this.darkModeMediaQuery = (typeof window !== 'undefined' && window.matchMedia)\n      ? window.matchMedia('(prefers-color-scheme: dark)')\n      : null\n\n    const isDarkModeOnFromTheStart = this.darkModeMediaQuery ? this.darkModeMediaQuery.matches : false\n    this.uppy.log(`[Dashboard] Dark mode is ${isDarkModeOnFromTheStart ? 'on' : 'off'}`)\n    this.setDarkModeCapability(isDarkModeOnFromTheStart)\n\n    if (this.opts.theme === 'auto') {\n      this.darkModeMediaQuery.addListener(this.handleSystemDarkModeChange)\n    }\n\n    this.discoverProviderPlugins()\n    this.initEvents()\n  }\n\n  uninstall = () => {\n    if (!this.opts.disableInformer) {\n      const informer = this.uppy.getPlugin(`${this.id}:Informer`)\n      // Checking if this plugin exists, in case it was removed by uppy-core\n      // before the Dashboard was.\n      if (informer) this.uppy.removePlugin(informer)\n    }\n\n    if (!this.opts.disableStatusBar) {\n      const statusBar = this.uppy.getPlugin(`${this.id}:StatusBar`)\n      if (statusBar) this.uppy.removePlugin(statusBar)\n    }\n\n    if (!this.opts.disableThumbnailGenerator) {\n      const thumbnail = this.uppy.getPlugin(`${this.id}:ThumbnailGenerator`)\n      if (thumbnail) this.uppy.removePlugin(thumbnail)\n    }\n\n    const plugins = this.opts.plugins || []\n    plugins.forEach((pluginID) => {\n      const plugin = this.uppy.getPlugin(pluginID)\n      if (plugin) plugin.unmount()\n    })\n\n    if (this.opts.theme === 'auto') {\n      this.darkModeMediaQuery.removeListener(this.handleSystemDarkModeChange)\n    }\n\n    this.unmount()\n    this.removeEvents()\n  }\n}\n"]}